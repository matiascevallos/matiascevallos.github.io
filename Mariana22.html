<!DOCTYPE HTML>
<html>
    <head>
        <title>Mariana22</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/game.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    </head>
    <body class="is-preload">
        <div id="page-wrapper">
            <section id="banner">
                <div class="inner">
                    <h1>Bienvenida a tu primer regalo de cumplea√±os</h1>
                    <button id="viewAll">Revelar todos los regalos (no presionar)</button>
                    <h2>Como funciona?</h2>
                    <p>Todos los d√≠as vas a poder jugar un juego. Cada juego te dar√° la oportunidad de identificar una pista de un regalo especial. ¬°Divi√©rtete y buena suerte!</p>
                </div>
            </section>
            <section id="game">
                <div class="inner">
                    <h2>Juego del D√≠a</h2>
                    <p>Aqu√≠ es donde se jugar√° el juego del d√≠a. ¬°Buena suerte!</p>
                    <p>Si ya jugaste antes, puedes ver tus respuestas anteriores</p>
                    <p>Ingresa primero la respuesta anterior: <input type="text" id="lastAnswer" /></p>
                    <button id="viewPreviousAnswers">Ver</button>
                    <button id="showGame">Empezar a jugar</button>
                    <ul id="previousAnswers">
                    </ul>
                    <p>Ya sabes cual es el regalo? <input type="text" id="giftGuess"/></p>
                    <button id="checkGift">Probar</button>
                </div>
                <table id="wordle"> 
                    <tbody>

                    </tbody>
                </table>
            </section>
        </div>
    </body>
</html>
<script>
// Connections Game Data for KODAK
const connectionsGame = {
    title: "Connections Puzzle",
    solutionPhrase: "KODAK",
    categories: [
        { name: "Keys", words: ["Piano", "Lock", "Keyboard", "Treasure"] },
        { name: "Optic", words: ["Eyes", "Prism", "Glasses", "Telescope"] },
        { name: "Darkroom", words: ["Developer", "Negative", "Enlarger", "Chemical"] },
        { name: "Appear", words: ["Vanish", "Reveal", "Stage", "Illusion"] },
        { name: "Kolors", words: ["Gold", "Magenta", "Silver", "Black"] }
    ]
};

function renderConnectionsGame() {
    clearGameArea();
    const gameDiv = document.createElement("div");
    gameDiv.id = "connections-game";
    const title = document.createElement("h2");
    title.textContent = connectionsGame.title;
    gameDiv.appendChild(title);

    // Flatten and shuffle words
    let allWords = connectionsGame.categories.flatMap(cat => cat.words);
    allWords = allWords.sort(() => Math.random() - 0.5);

    // Track state
    let selected = [];
    let foundGroups = [];
    let lockedWords = new Set();

    // Grid
    const grid = document.createElement("div");
    grid.className = "connections-grid";
    grid.style.display = "grid";
    grid.style.gridTemplateColumns = "repeat(4, 1fr)";
    grid.style.gap = "10px";

    // Word tiles
    allWords.forEach(word => {
        const tile = document.createElement("button");
        tile.className = "connections-tile";
        tile.textContent = word;
        tile.style.padding = "16px";
        tile.style.fontSize = "1.1em";
        tile.style.cursor = "pointer";
        tile.style.transition = "all 0.2s";
        tile.onclick = () => {
            if (lockedWords.has(word)) return;
            if (selected.includes(word)) {
                selected = selected.filter(w => w !== word);
                tile.style.background = "";
            } else if (selected.length < 4) {
                selected.push(word);
                tile.style.background = "#ffe066";
            }
        };
        grid.appendChild(tile);
    });
    gameDiv.appendChild(grid);

    // Track attempts per day
    const today = new Date().toISOString().slice(0, 10);
    let attempts = Number(localStorage.getItem("connectionsAttempts" + today)) || 0;

    const submitBtn = document.createElement("button");
    submitBtn.textContent = "Probar grupo";
    submitBtn.style.marginTop = "20px";
    submitBtn.disabled = attempts >= 5;

    function updateAttempts() {
        attempts++;
        localStorage.setItem("connectionsAttempts" + today, attempts);
        if (attempts >= 5) {
            submitBtn.disabled = true;
            const lockMsg = document.createElement("div");
            lockMsg.textContent = "Ya usaste tus 5 intentos por hoy. Vuelve ma√±ana.";
            lockMsg.style.color = "#ff6b6b";
            lockMsg.style.margin = "10px 0";
            gameDiv.appendChild(lockMsg);
        }
    }

    submitBtn.onclick = () => {
        if (selected.length !== 4 || submitBtn.disabled) return;
        // Check group
        let found = false;
        for (const cat of connectionsGame.categories) {
            if (cat.words.every(w => selected.includes(w))) {
                found = true;
                foundGroups.push(cat.name);
                // Lock tiles
                Array.from(grid.children).forEach(tile => {
                    if (selected.includes(tile.textContent)) {
                        tile.style.background = "#b2f2ff";
                        tile.style.border = "2px solid #228be6";
                        tile.disabled = true;
                        lockedWords.add(tile.textContent);
                    }
                });
                // Reveal category
                const catDiv = document.createElement("div");
                catDiv.textContent = `Grupo encontrado: ${cat.name}`;
                catDiv.style.margin = "10px 0";
                catDiv.style.fontWeight = "bold";
                catDiv.style.color = "#228be6";
                gameDiv.appendChild(catDiv);
                break;
            }
        }
        if (!found) {
            updateAttempts();
            // Incorrect: shake selected tiles
            Array.from(grid.children).forEach(tile => {
                if (selected.includes(tile.textContent)) {
                    tile.style.background = "#ff6b6b";
                    tile.style.animation = "shake 0.3s";
                    setTimeout(() => {
                        tile.style.background = "";
                        tile.style.animation = "";
                    }, 400);
                }
            });
            // Feedback
            const feedback = document.createElement("div");
            feedback.textContent = "No es un grupo v√°lido, intenta de nuevo.";
            feedback.style.color = "#ff6b6b";
            feedback.style.margin = "10px 0";
            gameDiv.appendChild(feedback);
            setTimeout(() => feedback.remove(), 1200);
        }
        selected = [];
        // Completion
        if (foundGroups.length === 5) {
            const reveal = document.createElement("h3");
            reveal.textContent = `¬°Soluci√≥n: ${connectionsGame.solutionPhrase}!`;
            reveal.style.color = "#51cf66";
            reveal.style.fontSize = "2em";
            reveal.style.marginTop = "20px";
            gameDiv.appendChild(reveal);
            // Optional: celebratory animation
            const confetti = document.createElement("div");
            confetti.textContent = "üéâ";
            confetti.style.fontSize = "3em";
            confetti.style.marginTop = "10px";
            gameDiv.appendChild(confetti);
        }
    };
    gameDiv.appendChild(submitBtn);

    // Progress
    const progress = document.createElement("div");
    progress.id = "connections-progress";
    progress.style.marginTop = "15px";
    progress.textContent = `Grupos encontrados: 0/5`;
    gameDiv.appendChild(progress);

    // Update progress on group found
    const observer = new MutationObserver(() => {
        progress.textContent = `Grupos encontrados: ${foundGroups.length}/5`;
    });
    observer.observe(gameDiv, { childList: true });

    document.querySelector("#game .inner").appendChild(gameDiv);
}
    let gift = "jonas brothers greetings from your hometown";
    let answers = ["your", "from", "greetings", "hometown", "brothers", "jonas"];
    let wordToGuessIdx=0;

    function clearGameArea(){
        document.querySelector("#game .inner").innerHTML="";
        document.querySelector("#wordle tbody").innerHTML="";
    }
    function renderPreviousAnswers(lastAnswer){
        console.log(answers, lastAnswer);
        console.log("check answer", answers.indexOf(lastAnswer));
        const previousAnswersTitle=document.createElement("h1");
        previousAnswersTitle.textContent="Aqui estan todas tus anteriores respuestas, juntalas para descubrir tu regalo.";
        const previousAnswerList = document.querySelector("#previousAnswers");
        previousAnswerList.innerHTML = "";
        previousAnswerList.appendChild(previousAnswersTitle);
        if(answers.indexOf(lastAnswer)!=-1){
            wordToGuessIdx=answers.indexOf(lastAnswer)+1;
            for(let i=0; i<wordToGuessIdx; i++){
                const prevGuesses = document.createElement("p");
                prevGuesses.textContent = answers[i];
                previousAnswerList.appendChild(prevGuesses);
            }
        }else{
            const prevGuesses = document.createElement("p");
            prevGuesses.textContent = "No haz descubierto otras palabras, pero no pasa nada, puedes jugar hoy y descubrir una!";
            previousAnswerList.appendChild(prevGuesses);
        }
        
    };
    function renderSubmitButton() {
        let buttonRow = document.getElementById("buttonRow");
        if (!buttonRow) {
            buttonRow = document.createElement("div");
            buttonRow.id = "buttonRow";
            buttonRow.className = "button-row";
            document.querySelector("#game .inner").appendChild(buttonRow);
        }
        // Remove existing button if present
        const oldButton = document.getElementById("submitRow");
        if (oldButton) oldButton.remove();

        const submitButton = document.createElement("button");
        submitButton.id = "submitRow";
        submitButton.textContent = "Probar palabra";
        buttonRow.appendChild(submitButton);
    }

    function renderBackButton() {
        let buttonRow = document.getElementById("buttonRow");
        if (!buttonRow) {
            buttonRow = document.createElement("div");
            buttonRow.id = "buttonRow";
            buttonRow.className = "button-row";
            document.querySelector("#game .inner").appendChild(buttonRow);
        }
        // Remove existing button if present
        const oldButton = document.getElementById("backButton");
        if (oldButton) oldButton.remove();

        const backButton = document.createElement("button");
        backButton.id = "backButton";
        backButton.textContent = "Ir a la pagina principal";
        buttonRow.appendChild(backButton);
    }
    //games to be rendered
    function renderScavengerHunt() {
        //Logic for scavenger hunt
        console.log("Iniciando la b√∫squeda del tesoro...");
        gameTitle.innerText = "Scavenger Hunt";
        document.querySelector("#game .inner").appendChild(gameTitle);
        console.log("Pregunta: ¬øD√≥nde se encuentra el regalo?");
        console.log("lastAnswer", lastAnswer);
        const question = "¬øD√≥nde se encuentra el regalo?"; // get the question from the game
        const hint = "Busca en la habitaci√≥n donde guardas tus juguetes."; //get hint from the game
        const questionElement = document.createElement("h2");
        questionElement.id = "question";
        questionElement.innerText = question;
        document.querySelector("#game .inner").appendChild(questionElement);
        const hintButton = document.createElement("button");
        hintButton.id = "getHint";
        hintButton.innerText = "Mostrar pista";
        document.querySelector("#game .inner").appendChild(hintButton);
        const hintText = document.createElement("p");
        hintText.innerText = hint;
        document.getElementById("getHint").addEventListener("click", () => {
            document.querySelector("#game .inner").appendChild(hintText);
        });
    };
    function renderWordle (wordToGuess) {
        renderSubmitButton();
        renderBackButton();
        const gridRow = 5;
        const gridCol = wordToGuess.length;
        let currRow = 0;
        const tbody = document.querySelector("#wordle tbody");
        for(let r=0; r<gridRow; r++){
            const tr = document.createElement("tr");
            for(let c=0; c<gridCol; c++){
                const td = document.createElement("td");
                const input = document.createElement("input");
                input.type="text";
                input.maxLength=1;
                input.size=1;
                input.disabled = r!==0;
                input.dataset.row=r;
                input.dataset.col=c;
                td.appendChild(input);
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }
        document.getElementById("submitRow").addEventListener("click", () => {
            console.log("submit clicked");
            for(let c=0; c<gridCol; c++){
                const input = document.querySelector(`input[data-row="${currRow}"][data-col="${c}"]`)
                const val = input.value.trim().toLowerCase();
                if(val === wordToGuess[c]){
                    input.style.backgroundColor = "green";
                } else if(wordToGuess.includes(val) && wordToGuess.indexOf(val) !== c) {
                    input.style.backgroundColor = "orange";
                } else {
                    input.style.backgroundColor = "red";
                }
                input.disabled=true;
            }
            currRow++;
            if(currRow<gridRow){
                for(let c=0; c<gridCol; c++){
                    document.querySelector(`input[data-row="${currRow}"][data-col="${c}"]`).disabled=false;
                }
            }
        });
    };
    function renderConnections () {

    };
    function rednerCrossword(){

    };

    document.getElementById("showGame").addEventListener("click", () => {
        const today = new Date().toISOString().slice(0, 10);
        const lastPlayed = localStorage.getItem("lastPlayedDate");
        if (lastPlayed === today) {
            alert("Ya jugaste hoy. Vuelve ma√±ana para el siguiente juego o para volver a intentarlo.");
            return;
        }
        localStorage.setItem("lastPlayedDate", today);
        clearGameArea();
        renderConnectionsGame();
    });
    document.getElementById("viewPreviousAnswers").addEventListener("click", () => {
        renderPreviousAnswers(document.getElementById("lastAnswer").value);
    });
    document.getElementById("viewAll").addEventListener("click", () => {
        const today = new Date().toISOString().slice(0, 10);
        alert("Todos los juegos estan bloqueados por hoy, no seas tramposa!");
        localStorage.setItem("lastPlayedDate", today);
    });
    document.getElementById("checkGift").addEventListener("click", () => {
        const today = new Date().toISOString().slice(0, 10);
        const lastPlayed = localStorage.getItem("lastPlayedDate");
        if (lastPlayed === today) {
            alert("Ya jugaste hoy. Vuelve ma√±ana para el siguiente juego o para volver a intentarlo.");
            return;
        }
        localStorage.setItem("lastPlayedDate", today);
        let giftGuess = document.getElementById("giftGuess").value;
        // Normalize: remove spaces and lowercase
        const normalized = giftGuess.replace(/\s+/g, '').toLowerCase();
        if (normalized.includes('jonas') && normalized.includes('brothers')) {
            alert("¬°Felicitaciones, empieza a decidir tu outfit y aprender sus canciones!");
        } else {
            const today = new Date().toISOString().slice(0, 10);
            alert("Intenta de nuevo de nuevo ma√±ana, solo tienes un intento por dia. Ya no puedes jugar mas por hoy.");
            localStorage.setItem("lastPlayedDate", today);
        }
    });
    localStorage.removeItem("lastPlayedDate");

</script>
