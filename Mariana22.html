<!DOCTYPE HTML>
<html>
    <head>
        <title>Mariana22</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/game.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    </head>
    <body class="is-preload">
        <div id="page-wrapper">
            <section id="banner">
                <div class="inner">
                    <h1>Bienvenida a tu primer regalo de cumpleaños</h1>
                    <button id="viewAll">Revelar todos los regalos (no presionar)</button>
                    <h2>Como funciona?</h2>
                    <p>Todos los días vas a poder jugar un juego. Cada juego te dará la oportunidad de identificar una pista de un regalo especial. ¡Diviértete y buena suerte!</p>
                </div>
            </section>
            <section id="game">
                <div class="inner">
                    <h2>Juego del Día</h2>
                    <p>Aquí es donde se jugará el juego del día. ¡Buena suerte!</p>
                    <p>Si ya jugaste antes, puedes ver tus respuestas anteriores</p>
                    <p>Ingresa primero la respuesta anterior: <input type="text" id="lastAnswer" /></p>
                    <button id="viewPreviousAnswers">Ver</button>
                    <button id="showGame">Empezar a jugar</button>
                    <ul id="previousAnswers">
                    </ul>
                    <p>Ya sabes cual es el regalo? <input type="text" id="giftGuess"/></p>
                    <button id="checkGift">Probar</button>
                </div>
                <table id="wordle"> 
                    <tbody>

                    </tbody>
                </table>
            </section>
        </div>
    </body>
</html>
<script>
function renderStrands() {
    clearGameArea();
    const gridSize = 8;
    // Fixed grid of letters
    const letters = [
        'C','A','R','U','A','E','C','T',
        'A','N','G','R','L','O','N','A',
        'R','R','M','E','S','E','V','C',
        'M','E','M','T','R','I','E','L',
        'I','R','O','E','L','P','U','A',
        'A','N','F','N','F','O','Q','R',
        'F','S','Q','R','Y','A','S','Q',
        'R','L','V','E','L','U','R','R',
    ];

    // Track selection
    let selectedCells = [];
    let wordFormed = "";

    // Word display
    const wordDisplay = document.createElement("h3");
    wordDisplay.textContent = "";
    wordDisplay.style.marginBottom = "15px";
    document.querySelector("#game .inner").appendChild(wordDisplay);

    // Confirm button
    const confirmBtn = document.createElement("button");
    confirmBtn.textContent = "Confirmar palabra";
    confirmBtn.style.margin = "10px 0";
    document.querySelector("#game .inner").appendChild(confirmBtn);

    // Found words display
    const foundWordsDiv = document.createElement("div");
    foundWordsDiv.style.marginTop = "20px";
    document.querySelector("#game .inner").appendChild(foundWordsDiv);

    const targetWords = ["CARRETE", "ANGULO", "MEMORIA", "ENFOQUE", "REVELAR", "ALCANCE"];
    let foundWords = [];

    function updateFoundWords() {
        foundWordsDiv.innerHTML = "<strong>Palabras encontradas:</strong> " + foundWords.join(", ") +
            `<br><strong>Faltan:</strong> ${targetWords.length - foundWords.length}`;
    }
    updateFoundWords();

    confirmBtn.onclick = function() {
        const formed = wordDisplay.textContent.toUpperCase();
        if (targetWords.includes(formed) && !foundWords.includes(formed)) {
            foundWords.push(formed);
            updateFoundWords();
            const msg = document.createElement("div");
            msg.textContent = `¡Encontraste la palabra: ${formed}!`;
            msg.style.color = "#51cf66";
            msg.style.margin = "10px 0";
            document.querySelector("#game .inner").appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
        } else if (foundWords.includes(formed)) {
            const msg = document.createElement("div");
            msg.textContent = `Ya encontraste la palabra: ${formed}.`;
            msg.style.color = "#fab005";
            msg.style.margin = "10px 0";
            document.querySelector("#game .inner").appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
        } else {
            const msg = document.createElement("div");
            msg.textContent = "No es una palabra válida.";
            msg.style.color = "#ff6b6b";
            msg.style.margin = "10px 0";
            document.querySelector("#game .inner").appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
        }
        // Reset selection
        wordDisplay.textContent = "";
        wordFormed = "";
        selectedCells.forEach(cellId => {
            const [r, c] = cellId.split(",").map(Number);
            const td = grid.rows[r].cells[c];
            td.style.background = "";
        });
        selectedCells = [];
    };

    // Grid
    const grid = document.createElement("table");
    grid.className = "strands-grid";
    grid.style.borderCollapse = "collapse";
    grid.style.margin = "auto";
    for (let r = 0; r < gridSize; r++) {
        const tr = document.createElement("tr");
        for (let c = 0; c < gridSize; c++) {
            const td = document.createElement("td");
            td.textContent = letters[r * gridSize + c];
            td.style.width = "32px";
            td.style.height = "32px";
            td.style.textAlign = "center";
            td.style.fontSize = "1.2em";
            td.style.border = "1px solid #ccc";
            td.style.cursor = "pointer";
            td.dataset.row = r;
            td.dataset.col = c;
            td.onclick = function() {
                const cellId = r + "," + c;
                if (selectedCells.includes(cellId)) return; // can't repeat
                if (selectedCells.length > 0) {
                    // Must be adjacent to last selected
                    const [lastR, lastC] = selectedCells[selectedCells.length - 1].split(",").map(Number);
                    if (Math.abs(lastR - r) > 1 || Math.abs(lastC - c) > 1) return;
                }
                selectedCells.push(cellId);
                td.style.background = "#ffe066";
                wordFormed += td.textContent;
                wordDisplay.textContent = wordFormed;
            };
            tr.appendChild(td);
        }
        grid.appendChild(tr);
    }
    document.querySelector("#game .inner").appendChild(grid);
}
// Connections Game Data for KODAK
const connectionsGame = {
    title: "Connections Puzzle",
    solutionPhrase: "KODAK",
    categories: [
        { name: "Keys", words: ["Piano", "Lock", "Keyboard", "Treasure"] },
        { name: "Optic", words: ["Eyes", "Prism", "Glasses", "Telescope"] },
        { name: "Darkroom", words: ["Developer", "Negative", "Enlarger", "Chemical"] },
        { name: "Appear", words: ["Vanish", "Reveal", "Stage", "Illusion"] },
        { name: "Kolors", words: ["Gold", "Magenta", "Silver", "Black"] }
    ]
};

/*
    K – Keys (old projector brand, related to cinema/film history)
    O – Optic (lens science, but not directly “camera”)
    D – Darkroom (where film is developed)
    A – Appear (controls light, photography concept)
    K – Kolors (classic film type, indirect nod to Kodak)

    F – Focal (lens property)
    I – ISO (film speed setting, less obvious unless you know photography)
    L – Latent (as in “latent image” before film development)
    M – Magnesium (used in old flash powder for photography)

    C – Carrete 
    A – Angulo
    M – Memoria
    E – Enfoque
    R – Revelar
    A – Alcance
*/

function renderConnectionsGame() {
    clearGameArea();
    const gameDiv = document.createElement("div");
    gameDiv.id = "connections-game";
    const title = document.createElement("h2");
    title.textContent = connectionsGame.title;
    gameDiv.appendChild(title);

    // Flatten and shuffle words
    let allWords = connectionsGame.categories.flatMap(cat => cat.words);
    allWords = allWords.sort(() => Math.random() - 0.5);

    // Track state
    let selected = [];
    let foundGroups = [];
    let lockedWords = new Set();

    // Grid
    const grid = document.createElement("div");
    grid.className = "connections-grid";
    grid.style.display = "grid";
    grid.style.gridTemplateColumns = "repeat(4, 1fr)";
    grid.style.gap = "10px";

    // Word tiles
    allWords.forEach(word => {
        const tile = document.createElement("button");
        tile.className = "connections-tile";
        tile.textContent = word;
        tile.style.padding = "16px";
        tile.style.fontSize = "1.1em";
        tile.style.cursor = "pointer";
        tile.style.transition = "all 0.2s";
        tile.onclick = () => {
            if (lockedWords.has(word)) return;
            if (selected.includes(word)) {
                selected = selected.filter(w => w !== word);
                tile.style.background = "";
            } else if (selected.length < 4) {
                selected.push(word);
                tile.style.background = "#ffe066";
            }
        };
        grid.appendChild(tile);
    });
    gameDiv.appendChild(grid);

    // Track attempts per day
    const today = new Date().toISOString().slice(0, 10);
    let attempts = Number(localStorage.getItem("connectionsAttempts" + today)) || 0;

    const submitBtn = document.createElement("button");
    submitBtn.textContent = "Probar grupo";
    submitBtn.style.marginTop = "20px";
    submitBtn.disabled = attempts >= 5;

    function updateAttempts() {
        attempts++;
        localStorage.setItem("connectionsAttempts" + today, attempts);
        if (attempts >= 5) {
            submitBtn.disabled = true;
            const lockMsg = document.createElement("div");
            lockMsg.textContent = "Ya usaste tus 5 intentos por hoy. Vuelve mañana.";
            lockMsg.style.color = "#ff6b6b";
            lockMsg.style.margin = "10px 0";
            gameDiv.appendChild(lockMsg);
        }
    }

    submitBtn.onclick = () => {
        if (selected.length !== 4 || submitBtn.disabled) return;
        // Check for 3 of the same group before validating
        for (const cat of connectionsGame.categories) {
            const count = selected.filter(w => cat.words.includes(w)).length;
            if (count === 3) {
                const oneAwayMsg = document.createElement("div");
                oneAwayMsg.textContent = "You are one away!";
                oneAwayMsg.style.color = "#fab005";
                oneAwayMsg.style.margin = "10px 0";
                gameDiv.appendChild(oneAwayMsg);
                setTimeout(() => oneAwayMsg.remove(), 2000);
                break;
            }
        }
        // Check group
        let found = false;
        for (const cat of connectionsGame.categories) {
            if (cat.words.every(w => selected.includes(w))) {
                found = true;
                foundGroups.push(cat.name);
                // Lock tiles
                Array.from(grid.children).forEach(tile => {
                    if (selected.includes(tile.textContent)) {
                        tile.style.background = "#b2f2ff";
                        tile.style.border = "2px solid #228be6";
                        tile.disabled = true;
                        lockedWords.add(tile.textContent);
                    }
                });
                // Reveal category
                const catDiv = document.createElement("div");
                catDiv.textContent = `Grupo encontrado: ${cat.name}`;
                catDiv.style.margin = "10px 0";
                catDiv.style.fontWeight = "bold";
                catDiv.style.color = "#228be6";
                gameDiv.appendChild(catDiv);
                break;
            }
        }
        if (!found) {
            updateAttempts();
            // Incorrect: shake selected tiles
            Array.from(grid.children).forEach(tile => {
                if (selected.includes(tile.textContent)) {
                    tile.style.background = "#ff6b6b";
                    tile.style.animation = "shake 0.3s";
                    setTimeout(() => {
                        tile.style.background = "";
                        tile.style.animation = "";
                    }, 400);
                }
            });
            // Feedback
            const feedback = document.createElement("div");
            feedback.textContent = "No es un grupo válido, intenta de nuevo.";
            feedback.style.color = "#ff6b6b";
            feedback.style.margin = "10px 0";
            gameDiv.appendChild(feedback);
            setTimeout(() => feedback.remove(), 1200);
        }
        selected = [];
        // Completion
        if (foundGroups.length === 5) {
            const reveal = document.createElement("h3");
            reveal.textContent = `¡Solución: ${connectionsGame.solutionPhrase}!`;
            reveal.style.color = "#51cf66";
            reveal.style.fontSize = "2em";
            reveal.style.marginTop = "20px";
            gameDiv.appendChild(reveal);
            // Optional: celebratory animation
            const confetti = document.createElement("div");
            confetti.textContent = "🎉";
            confetti.style.fontSize = "3em";
            confetti.style.marginTop = "10px";
            gameDiv.appendChild(confetti);
        }
    };
    gameDiv.appendChild(submitBtn);

    // Progress
    const progress = document.createElement("div");
    progress.id = "connections-progress";
    progress.style.marginTop = "15px";
    progress.textContent = `Grupos encontrados: 0/5`;
    gameDiv.appendChild(progress);

    // Update progress on group found
    const observer = new MutationObserver(() => {
        progress.textContent = `Grupos encontrados: ${foundGroups.length}/5`;
    });
    observer.observe(gameDiv, { childList: true });

    document.querySelector("#game .inner").appendChild(gameDiv);
}
    let gift = "jonas brothers greetings from your hometown";
    let answers = ["kodak", "film", "camera"];
    let lastAnswerInput="";
    let wordToGuessIdx=0;

    function clearGameArea(){
        document.querySelector("#game .inner").innerHTML="";
        document.querySelector("#wordle tbody").innerHTML="";
    }
    function renderPreviousAnswers(lastAnswer){
        lastAnswerInput=lastAnswer;
        const previousAnswersTitle=document.createElement("h1");
        previousAnswersTitle.textContent="Aqui estan todas tus anteriores respuestas, juntalas para descubrir tu regalo.";
        const previousAnswerList = document.querySelector("#previousAnswers");
        previousAnswerList.innerHTML = "";
        previousAnswerList.appendChild(previousAnswersTitle);
        if(answers.indexOf(lastAnswer)!=-1){
            wordToGuessIdx=answers.indexOf(lastAnswer)+1;
            for(let i=0; i<wordToGuessIdx; i++){
                const prevGuesses = document.createElement("p");
                prevGuesses.textContent = answers[i];
                previousAnswerList.appendChild(prevGuesses);
            }
        }else{
            const prevGuesses = document.createElement("p");
            prevGuesses.textContent = "No haz descubierto otras palabras, pero no pasa nada, puedes jugar hoy y descubrir una!";
            previousAnswerList.appendChild(prevGuesses);
        }
        
    };
    function renderSubmitButton() {
        let buttonRow = document.getElementById("buttonRow");
        if (!buttonRow) {
            buttonRow = document.createElement("div");
            buttonRow.id = "buttonRow";
            buttonRow.className = "button-row";
            document.querySelector("#game .inner").appendChild(buttonRow);
        }
        // Remove existing button if present
        const oldButton = document.getElementById("submitRow");
        if (oldButton) oldButton.remove();

        const submitButton = document.createElement("button");
        submitButton.id = "submitRow";
        submitButton.textContent = "Probar palabra";
        buttonRow.appendChild(submitButton);
    }

    function renderBackButton() {
        let buttonRow = document.getElementById("buttonRow");
        if (!buttonRow) {
            buttonRow = document.createElement("div");
            buttonRow.id = "buttonRow";
            buttonRow.className = "button-row";
            document.querySelector("#game .inner").appendChild(buttonRow);
        }
        // Remove existing button if present
        const oldButton = document.getElementById("backButton");
        if (oldButton) oldButton.remove();

        const backButton = document.createElement("button");
        backButton.id = "backButton";
        backButton.textContent = "Ir a la pagina principal";
        buttonRow.appendChild(backButton);
    }
    //games to be rendered
    function renderScavengerHunt() {
        //Logic for scavenger hunt
        console.log("Iniciando la búsqueda del tesoro...");
        gameTitle.innerText = "Scavenger Hunt";
        document.querySelector("#game .inner").appendChild(gameTitle);
        console.log("Pregunta: ¿Dónde se encuentra el regalo?");
        console.log("lastAnswer", lastAnswer);
        const question = "¿Dónde se encuentra el regalo?"; // get the question from the game
        const hint = "Busca en la habitación donde guardas tus juguetes."; //get hint from the game
        const questionElement = document.createElement("h2");
        questionElement.id = "question";
        questionElement.innerText = question;
        document.querySelector("#game .inner").appendChild(questionElement);
        const hintButton = document.createElement("button");
        hintButton.id = "getHint";
        hintButton.innerText = "Mostrar pista";
        document.querySelector("#game .inner").appendChild(hintButton);
        const hintText = document.createElement("p");
        hintText.innerText = hint;
        document.getElementById("getHint").addEventListener("click", () => {
            document.querySelector("#game .inner").appendChild(hintText);
        });
    };
    function renderWordle (wordToGuess) {
        renderSubmitButton();
        renderBackButton();
        const gridRow = 5;
        const gridCol = wordToGuess.length;
        let currRow = 0;
        const tbody = document.querySelector("#wordle tbody");
        for(let r=0; r<gridRow; r++){
            const tr = document.createElement("tr");
            for(let c=0; c<gridCol; c++){
                const td = document.createElement("td");
                const input = document.createElement("input");
                input.type="text";
                input.maxLength=1;
                input.size=1;
                input.disabled = r!==0;
                input.dataset.row=r;
                input.dataset.col=c;
                td.appendChild(input);
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }
        document.getElementById("submitRow").addEventListener("click", () => {
            console.log("submit clicked");
            for(let c=0; c<gridCol; c++){
                const input = document.querySelector(`input[data-row="${currRow}"][data-col="${c}"]`)
                const val = input.value.trim().toLowerCase();
                if(val === wordToGuess[c]){
                    input.style.backgroundColor = "green";
                } else if(wordToGuess.includes(val) && wordToGuess.indexOf(val) !== c) {
                    input.style.backgroundColor = "orange";
                } else {
                    input.style.backgroundColor = "red";
                }
                input.disabled=true;
            }
            currRow++;
            if(currRow<gridRow){
                for(let c=0; c<gridCol; c++){
                    document.querySelector(`input[data-row="${currRow}"][data-col="${c}"]`).disabled=false;
                }
            }
        });
    };

    document.getElementById("showGame").addEventListener("click", () => {
        const today = new Date().toISOString().slice(0, 10);
        const lastPlayed = localStorage.getItem("lastPlayedDate");
        if (lastPlayed === today) {
            alert("Ya jugaste hoy. Vuelve mañana para el siguiente juego o para volver a intentarlo.");
            return;
        }
        localStorage.setItem("lastPlayedDate", today);
        clearGameArea();
        let lastAnswer = lastAnswerInput;
        if (!lastAnswer) {
            renderConnectionsGame();
        } else if (lastAnswer === "kodak") {
            renderWordle("film");
        } else if (lastAnswer === "film") {
            renderStrands();
        } else {
            // Default: show connections if unknown answer
            renderConnectionsGame();
        }
    });
    document.getElementById("viewPreviousAnswers").addEventListener("click", () => {
        renderPreviousAnswers(document.getElementById("lastAnswer").value);
    });
    document.getElementById("viewAll").addEventListener("click", () => {
        const today = new Date().toISOString().slice(0, 10);
        alert("Todos los juegos estan bloqueados por hoy, no seas tramposa!");
        localStorage.setItem("lastPlayedDate", today);
    });
    document.getElementById("checkGift").addEventListener("click", () => {
        const today = new Date().toISOString().slice(0, 10);
        const lastPlayed = localStorage.getItem("lastPlayedDate");
        if (lastPlayed === today) {
            alert("Ya jugaste hoy. Vuelve mañana para el siguiente juego o para volver a intentarlo.");
            return;
        }
        localStorage.setItem("lastPlayedDate", today);
        let giftGuess = document.getElementById("giftGuess").value;
        // Normalize: remove spaces and lowercase
        const normalized = giftGuess.replace(/\s+/g, '').toLowerCase();
        if (normalized.includes('kodak') && normalized.includes('film') && normalized.includes('camera')) {
            alert("¡Felicitaciones, empieza a decidir tu outfit y aprender sus canciones!");
        } else {
            const today = new Date().toISOString().slice(0, 10);
            alert("Intenta de nuevo de nuevo mañana, solo tienes un intento por dia. Ya no puedes jugar mas por hoy.");
            localStorage.setItem("lastPlayedDate", today);
        }
    });
    localStorage.removeItem("lastPlayedDate");

</script>
